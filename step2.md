# ステップ2
## 環境設定
### 必要なソフトウェア
MySQL: データベース管理システム。本プロジェクトでは MySQL  8.3.0 を使用。

## MySQLをインストールしていない方

### 1.MySQLのインストール

MySQLは[公式webサイト](https://dev.mysql.com/downloads/mysql/)からインストールできます。公式の指示に従ってインストールしてください。

### 2.データベースとユーザーの作成

データベースシステムのセットアップ後、以下のコマンドを使用してプロジェクト用のデータベースとユーザーを作成します。

```sql
CREATE DATABASE '[作成したいデータベース名]';
CREATE USER '[作成したいユーザ名]'@'[ホスト名]' IDENTIFIED BY '[指定したいパスワード]';
GRANT ALL PRIVILEGES ON '[作成したいデータベース名]'* TO '[作成したいユーザ名]'@'[ホスト名]';
FLUSH PRIVILEGES;
```

### 環境の確認方法

使用している MySQL のバージョンを確認するには、以下の SQL コマンドを実行します。

`SELECT version();`

## その他の基本動作
MySQLの起動
`mysql.server start`

MySQLにログイン（実行、接続とも）
`mysql -u root -p`

MySQLの停止（終了とも）

`mysql.server stop`



---
## 1. データベースの作成

以下のコマンドでデータベースを作成できます。

`CREATE DATABASE internet_tv;`

データベースを作成した後、作成したデータベースを選択します。

`USE internet_tv;`

## 2.テーブルの作成

__channelsテーブル__
```sql
CREATE TABLE channels (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);
```
__episodes テーブル__
```sql
CREATE TABLE episodes (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    season_id BIGINT,
    episode_number INT,
    title VARCHAR(100) NOT NULL,
    detail TEXT,
    duration INT DEFAULT 30,
    release_date DATE NOT NULL,
    view_count BIGINT NOT NULL DEFAULT 0,
    broadcast_start_time DATETIME,
    broadcast_end_time DATETIME,
    FOREIGN KEY (season_id) REFERENCES seasons(id)
);
```
__genres テーブル__
```sql
CREATE TABLE genres (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);

CREATE TABLE program_genres (
    program_id BIGINT,
    genre_id BIGINT,
    PRIMARY KEY (program_id, genre_id),
    FOREIGN KEY (program_id) REFERENCES programs(id),
    FOREIGN KEY (genre_id) REFERENCES genres(id)
);
```
__programs テーブル__
```sql
CREATE TABLE programs (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(100) NOT NULL,
    detail TEXT,
    genre_id BIGINT,
    channel_id BIGINT,
    FOREIGN KEY (channel_id) REFERENCES channels(id)
);
```
__seasons テーブル__
```sql
CREATE TABLE seasons (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    program_id BIGINT NOT NULL,
    season_number INT NOT NULL,
    FOREIGN KEY (program_id) REFERENCES programs(id)
);
```

__viewers テーブル__
```sql
CREATE TABLE viewers (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    content_id BIGINT NOT NULL,
    content_type VARCHAR(50) NOT NULL,
    view_count INT NOT NULL,
    view_date DATE NOT NULL,
    platform VARCHAR(50)
);
```


## 3.サンプルデータの挿入
```sql
-- チャンネルのデータ挿入
INSERT INTO channels (name) VALUES
('ドラマチャンネル'),
('アニメチャンネル'),
('スポーツチャンネル'),
('TBS'),
('フジテレビ'),
('テレビ朝日'),
('NHK'),
('ニュースチャンネル');

-- ジャンルのデータ挿入
INSERT INTO genres (name) VALUES
('ドラマ'),
('アニメ'),
('スポーツ'),
('バラエティ'),
('海外ドラマ'),
('ニュース'),
('ドキュメンタリー'),
('科学'),
('自然'),
('ライフスタイル'),
('音楽'),
('料理'),
('コメディ'),
('歴史');

-- program_genres テーブルのデータ挿入
INSERT INTO programs (id, title, detail, genre_id, channel_id) VALUES
(2, 'モブサイコ', '人気のアニメシリーズ', 2, 2),
(5, '逃げるは恥だが役にたつ', '人気の恋愛ドラマ', 1, 1),
(6, 'ソフトバンクホークス対楽天', 'プロ野球中継', 3, 2),
(7, '水曜日のダウンタウン', '人気バラエティ番組', 2, 3),
(8, 'マツコと有吉の怒り新党', '社会の様々な怒りをマツコと有吉がぶった斬る', 2, 1),
(9, 'フレンズ', 'アメリカの人気海外ドラマ', 7, 4),
(10, 'バク天！', '様々なゲストが登場するバラエティ番組', 2, 2),
(11, '有吉の壁', '芸人が様々なお笑いの壁に挑戦する番組', 5, 3),
(12, '世界の朝ニュース', '世界中の最新ニュースをお届けします。', 8, 12),
(13, '旅行記の足跡', '世界中の未知の地を探検するドキュメンタリー番組', 9, 7),
(14, '未来科学者', '最先端技術と未来の科学を探求する', 10, 4),
(15, '星空への手紙', '宇宙にまつわる神秘と美しさを紹介する', 9, 7),
(16, 'ギガント', '巨大建造物の秘密に迫る', 9, 7),
(17, '海の守り手', '海洋保護に人生を捧げる人々の物語', 11, 7),
(18, 'デジタルデトックス', 'テクノロジーから離れ、自然とのつながりを取り戻す方法を探る', 12, 6),
(19, '音楽の都市伝説', '有名な音楽とそれにまつわる都市伝説を探る', 13, 5),
(20, '味の冒険', '世界のさまざまな地域の料理と文化を紹介する', 14, 3),
(21, 'コメディナイト', '新進気鋭のコメディアンたちが繰り広げるライブ', 15, 1),
(22, 'ヒーロー伝説', '歴史上の英雄たちの生涯を描くドラマシリーズ', 16, 2),
(23, '猫に翼', '日本で初めて獣医になった女性の話', 1, 1),
(24, '愛人28号', '木曜夜のドラマ。謎に包まれた愛人の物語。', 1, 1),
(25, '料理の極意', '世界各国の料理技術を勝負するドラマ。', 1, 1),
(26, '歴史のかげで', '歴史上の重要な出来事を深掘りするドキュメンタリー。', 16, NULL),
(27, '夜空の音楽会', '夜空の下で行われるクラシック音楽会を放送。', 13, NULL),
('笑いの時間', '週末に放送されるスタンドアップコメディ番組。', 15, NULL),
('未来テクノロジー', '最新技術と未来の予測にフォーカスした科学番組。', 10, NULL);

-- seasons テーブルのデータ挿入
INSERT INTO seasons (program_id, season_number) VALUES
(5, 1),
(11, 1),
(2, 1),
(23, 1);

-- episodes テーブルのデータ挿入
INSERT INTO episodes (season_id, episode_number, title, detail, duration, release_date, view_count, broadcast_start_time, broadcast_end_time) VALUES
(2, 1, '逃げるは恥だが役にたつ 第1話', '新婚生活スタート', 60, '2023-04-05', 50000, '2023-04-05 20:00:00', '2023-04-05 21:00:00'),
(3, 1, '有吉の壁 新春スペシャル', '芸人たちの壁挑戦', 120, '2023-04-05', 60000, '2023-04-05 21:00:00', '2023-04-05 23:00:00'),
(4, 1, '世界の朝ニュース 第1話', '今日のトップニュースは...', 30, '2023-10-01', 70000, '2023-10-01 06:00:00', '2023-10-01 06:30:00'),
(5, 1, 'フレンズ 第1話', '新しいアパート', 30, '1994-09-22', 133040, '2024-04-07 20:00:00', '2024-04-07 20:30:00'),
(5, 2, 'フレンズ 第2話', 'カフェでのひと時', 30, '1994-09-29', 4330, '2024-04-08 20:00:00', '2024-04-08 20:30:00'),
(5, 10, 'フィービーの歌', 'フィービーが自作の歌を公演するが、予期せぬ反応が...', 30, '1994-11-24', 12695, '2024-04-09 20:00:00', '2024-04-09 20:30:00'),
(5, 11, 'クリスマスの奇跡', 'クリスマスにみんなで奇跡を起こそうと奮闘。', 30, '1994-12-01', 42695, '2024-04-10 20:00:00', '2024-04-10 20:30:00'),
(5, 12, '新年の誓い', '年末に向けて、グループがそれぞれ新年の誓いを立てる。', 30, '1994-12-08', 1242695, '2024-04-11 20:00:00', '2024-04-11 20:30:00'),
(5, 1, 'モブサイコ 第1話', 'モブの日常と冒険が始まる', 30, '2023-04-12', 20000, NULL, NULL),
(5, 2, 'モブサイコ 第2話', '新たな敵の登場', 30, '2023-04-19', 21000, NULL, NULL),
(7, 1, '獣医への夢', '主人公が獣医になる夢を追い始める物語。', 15, '2024-04-08', 100, '2024-04-08 07:00:00', '2024-04-08 07:15:00'),
(7, 2, '最初の試練', '主人公が獣医学校での最初の試練に直面する。', 15, '2024-04-09', 120, '2024-04-09 07:00:00', '2024-04-09 07:15:00'),
(7, 1, '謎の出会い', '愛人28号の謎が徐々に明らかになる第一話。', 60, '2024-04-11', 200, '2024-04-11 23:00:00', '2024-04-12 00:00:00'),
(7, 1, '世界の料理対決', '世界中から集まった料理人が技を競う。', 45, '2024-04-07', 150, '2024-04-07 18:00:00', '2024-04-07 18:45:00'),
(7, 2, '寿司の秘密', '寿司作りの極意に迫る。', 45, '2024-04-14', 180, '2024-04-14 18:00:00', '2024-04-14 18:45:00'),
(7, 1, '秘められた古代文明', '未発見の古代文明に関する新たな発見。', 60, '2024-04-08', 200, '2024-04-08 21:00:00', '2024-04-08 22:00:00'),
(7, 2, '歴史的大発見', '新しい考古学的発見が歴史を塗り替える。', 60, '2024-04-15', 220, '2024-04-15 21:00:00', '2024-04-15 22:00:00'),
(7, 1, '星に願いを', 'クラシック音楽と共に夜空を旅する。', 90, '2024-04-09', 250, '2024-04-09 20:00:00', '2024-04-09 21:30:00'),
(7, 2, '月光のセレナーデ', '月明かりの下、心を打つ演奏をお届け。', 90, '2024-04-16', 275, '2024-04-16 20:00:00', '2024-04-16 21:30:00'),
(7, 1, '笑いの祭典', '国内外から選りすぐりのコメディアンが集結。', 120, '2024-04-10', 300, '2024-04-10 19:00:00', '2024-04-10 21:00:00'),
(7, 1, '進化するAI', '人工知能の最新動向とその影響。', 30, '2024-04-11', 400, '2024-04-11 22:00:00', '2024-04-11 22:30:00'),
(7, 2, '宇宙への旅立ち', '宇宙旅行技術の革新と未来の展望。', 30, '2024-04-18', 420, '2024-04-18 22:00:00', '2024-04-18 22:30:00'),
(7, 1, '猫の新しい一歩', '街を彩る猫たちの冒険物語。', 15, '2024-04-12', 500, '2024-04-12 07:00:00', '2024-04-12 07:15:00'),
(7, 2, '猫たちの日常', '猫たちの心温まる日常のひとコマ。', 15, '2024-04-19', 520, '2024-04-19 07:00:00', '2024-04-19 07:15:00'),
(7, 4, '猫に翼 第4話', '主人公が初めて猫の手術を行う。', 15, '2024-04-10', 0, '2024-04-10 07:00:00', '2024-04-10 07:15:00'),
(7, 5, '猫に翼 第5話', '困難なケースに直面し、成長する主人公。', 15, '2024-04-11', 0, '2024-04-11 07:00:00', '2024-04-11 07:15:00');

-- program_genres テーブルのデータ挿入
INSERT INTO program_genres (program_id, genre_id) VALUES
(5, 1),
(23, 1),
(24, 1),
(25, 1),
(6, 3),
(7, 5),
(9, 7),
(12, 8),
(29, 10),
(27, 13),
(28, 15),
(26, 16);

-- viewers テーブルのデータ挿入
INSERT INTO viewers (content_id, content_type, view_count, view_date, platform) VALUES
(1, 'episode', 5000, '2023-04-06', 'web'),
(2, 'episode', 4500, '2023-04-06', 'mobile'),
(5, 'episode', 10000, '2023-10-01', 'web'),
(2, 'episode', 12000, '2023-04-07', 'web'),
(3, 'episode', 13000, '2023-04-07', 'mobile'),
(4, 'episode', 15000, '2023-04-07', 'web'),
(6, 'episode', 11000, '2023-04-07', 'mobile'),
(7, 'episode', 9000, '2023-04-07', 'web'),
(8, 'episode', 14000, '2023-04-07', 'mobile'),
(9, 'episode', 9500, '2023-04-07', 'web'),
(10, 'episode', 8500, '2023-04-07', 'mobile'),
(11, 'episode', 10500, '2023-04-07', 'web'),
(12, 'episode', 11500, '2023-04-07', 'mobile');
```